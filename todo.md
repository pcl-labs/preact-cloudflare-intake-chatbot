# ChatGPT-like Chat Interface Requirements

## Project Setup âœ…
- Preact project initialized with Vite âœ…
- TypeScript support configured âœ…
- ESLint with Preact configuration âœ…
- Development environment ready âœ…

## Core Features
- Implement chat interface using Preact functional components âœ…
  - Basic message component âœ…
  - Input handling âœ…
  - Message list with auto-scroll âœ…
- Utilize Preact's built-in state management (hooks) âœ…
  - Message state management âœ…
  - Input state management âœ…
- Design to resemble ChatGPT's interface âœ…
  - Basic layout structure âœ…
  - Dark/light theme support âœ…
  - Responsive design âœ…
  - UI polish and refinements âœ…
- Support for Markdown and code syntax highlighting âœ…
  - Install markdown library âœ…
  - Add code block support âœ…
  - Style markdown elements âœ…
- Support for sending/receiving files âœ…
  - Basic file upload component âœ…
  - File preview âœ…
  - File type validation âœ…
  - UI polish and refinements âœ…
- Loading indicators âœ…
  - Typing animation âœ…
  - Input disabled state âœ…
  - Loading state management âœ…
- Media recording support âœ…
  - Audio recording âœ…
    - Recording UI with waveform visualization âœ…
    - Timer display âœ…
    - Cancel/Confirm controls âœ…
    - Theme-consistent colors âœ…
    - Fluid animation with smooth transitions âœ…
    - Proper resource cleanup on browser âœ…
  - Media preview âœ…
    - Proper audio player in messages âœ…
    - Type-specific rendering âœ…
- Simple welcome message replacing introduction panel âœ…

## UI Refinements âœ…
- Repositioned audio recording button next to send button âœ…
- Hidden video recording (moved to future milestone) âœ…
- Cleaned up input controls layout âœ…
- Unified styling of controls with circular buttons âœ…
- Made send button change icon based on input state âœ…
- Optimized input area icon sizes for better proportions âœ…
- Improved placeholder vs input text distinction âœ…
- Enhanced theme color consistency across controls âœ…
- Fixed audio recording visualization with proper animation âœ…
- Implemented functional real-time audio visualization âœ…

## UI Components
- Create reusable Preact components:
  - ChatContainer (main wrapper component) âœ…
  - MessageList (virtualized list for performance) âœ…
  - Message (individual message component) âœ…
  - InputArea (composition of input components) âœ…
  - FileUpload component âœ…
  - LoadingIndicator component âœ…
  - MediaControls component âœ…
  - LazyMedia component âœ…
  - Lightbox component âœ…
  - FileMenu component âœ…
  - AudioRecordingUI component with visualization âœ…
  - CameraModal component âœ…
  - SkeletonLoader component for async loading âœ…

## Performance Requirements
- Bundle size optimization:
  - Code splitting for route-based components âœ…
  - Dynamic imports for heavy features âœ…
  - Tree-shaking friendly imports âœ…
  - Minimal external dependencies âœ…
- Runtime performance:
  - Efficient re-rendering with memo usage âœ…
  - Virtualized lists for message history âœ…
  - Lazy loading for images and media âœ…
  - Debounced event handlers âœ…
  - Optimized asset delivery âœ…
  - Efficient canvas rendering for audio visualization âœ…
- Build optimization:
  - Minification and compression âœ…
  - Modern bundle output targeting âœ…
  - Asset optimization pipeline âœ…
  - Critical CSS extraction âœ…
  - Bundle analysis with visualizer âœ…

## Recent Improvements (Latest Updates)
- Added Blawby Chat branding âœ…
  - Updated page title and metadata âœ…
  - Created custom favicon with theme support âœ…
  - Added OpenGraph and social sharing metadata âœ…
- Implemented dynamic imports with lazy loading âœ…
  - Added skeleton loading components âœ…
  - Lazy-loaded heavy components (MediaControls, FileMenu, etc.) âœ…
  - Created utility for easy component lazy loading âœ…
- Optimized build for production âœ…
  - Implemented Gzip and Brotli compression âœ…
  - Set up proper code splitting and chunking âœ…
  - Added critical CSS extraction for faster rendering âœ…
  - Configured PWA support for offline capabilities âœ…
  - Optimized asset delivery with proper organization âœ…
  - Fixed compression error messages with custom plugin âœ…
- Removed test/placeholder responses âœ…
  - Prepared for real API integration âœ…
  - Cleaned up mock data and test messages âœ…
- Added feature flags system âœ…
  - Created configuration for toggling features âœ…
  - Disabled voice recording via feature flag âœ…
  - Implemented conditional UI rendering âœ…
- Added comprehensive scheduling functionality âœ…
  - Implemented date selection with 3x3 grid UI âœ…
  - Created time-of-day and time slot selectors âœ…
  - Added scheduling confirmation cards with timezone support âœ…
  - Enabled user-initiated scheduling via Schedule button âœ…
  - Added AI-initiated scheduling with intent detection âœ…
  - Created utilities for managing scheduling conversation flows âœ…

## Next Immediate Tasks (Priority Order)
1. Integration with ai.blawby.com âœ…
   - Add teamId extraction from URL parameters âœ…
   - Update API endpoints to use teamId from URL âœ…
   - Implement business details fetching from API âœ…
   - Set up postMessage communication with parent frame âœ…
   - Add state change notifications (open/closed status) âœ…
   - Ensure proper iframe embedding behavior âœ…

2. Add scheduling functionality
   - Add "Schedule" button with icon next to the plus button âœ…
   - Implement date selection workflow with 3x3 grid (9 days) UI âœ…
   - Add "Show More Dates" button to extend selection beyond initial 9 days âœ…
   - Create time selection with morning/afternoon quick options âœ…
   - Implement 30-minute increment time slots after time-of-day selection âœ…
   - Add calendar icons next to scheduled dates in message history âœ…
   - Create visual confirmation card with date, time, and timezone information âœ…
   - Ensure all selections are sent as text messages in chat âœ…
   - Implement automatic timezone detection and display âœ…
   - Style components to match existing UI theme âœ…
   - Support AI-initiated scheduling flows âœ…
     - Add scheduling intent detection from user messages âœ…
     - Create utility for generating scheduling responses âœ…
     - Enable AI to proactively suggest scheduling âœ…
     - Integrate with conversation flow seamlessly âœ…

3. Accessibility improvements
   - Add keyboard navigation support
   - Improve screen reader compatibility
   - Add ARIA attributes to interactive elements
   - Implement focus management

4. Testing and QA
   - Test iframe embedding scenarios
   - Verify API connectivity with team contexts
   - Test cross-origin communication
   - Verify proper light/dark theme behavior in iframe context

## AI Training Data Storage & Analytics
1. Database Schema Enhancements for AI Training
   - Create `chat_logs` table for long-term storage of chat sessions
     - Store user/assistant/system messages with timestamps
     - Enable training datasets with (user â†’ assistant) pairs
     - Support auditing and response regeneration
   - Create `matter_questions` table for Q&A pairs from intake
     - Store individual question/answer pairs from matter creation
     - Track question sources (ai-form, human-entry, followup)
     - Identify confusing or useful questions for model improvement
   - Create `ai_generated_summaries` table for markdown matter summaries
     - Log LLM-generated matter summaries with model info
     - Store prompt snapshots for analysis
     - Enable summary quality tracking over time
   - Create `ai_feedback` table for user quality ratings
     - Store user ratings (1-5 scale) and thumbs up/down
     - Track conversation intent and comments
     - Enable quality scoring and model improvement

2. Data Collection Implementation
   - Modify chat handlers to log messages to `chat_logs` table
   - Update matter creation flow to store Q&A pairs in `matter_questions`
   - Add logging for AI-generated summaries in matter review step
   - Implement feedback collection UI for user ratings
   - Create data export utilities for training datasets

3. Analytics & Monitoring
   - Build dashboard for conversation quality metrics
   - Implement real-time quality scoring based on feedback
   - Create reports for model performance over time
   - Set up alerts for quality degradation or issues
   - Enable data export for fine-tuning when Cloudflare supports it

4. RAG Pipeline Preparation
   - Design retrieval system using stored chat logs
   - Implement semantic search across matter summaries
   - Create context injection for continuing conversations
   - Build knowledge base from successful matter outcomes

## Future Tasks
- Speech-to-text integration
- Text-to-speech integration
- Service worker for offline support (initial implementation done)
- Video recording capabilities
- Message search functionality
- Keyboard shortcuts and accessibility improvements
- Internationalization (i18n) support

## Horizon Milestones
- Video conferencing capabilities
  - WebRTC integration
  - Video chat UI components
  - Screen sharing support
  - Video recording and playback
- Advanced collaboration features
  - Real-time cursors
  - Shared whiteboard
  - Document collaboration

Legend:
âœ… - Completed
ğŸ”„ - In Progress/Planned
âŒ - Blocked/Issues 